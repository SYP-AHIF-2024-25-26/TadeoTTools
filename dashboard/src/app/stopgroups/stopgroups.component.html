<div class="flex justify-between mr-10 ml-10 mt-5">
  <div>
    <button (click)="saveChanges()" [disabled]="!hasChanged()"
            class="bg-blue-600 h-fit p-1.5 m-1.5 w-fit rounded text-white disabled:bg-gray-400">Save Changes
    </button>
    <button (click)="initialiseData()" [disabled]="!hasChanged()"
            class="bg-blue-600 h-fit p-1.5 m-1.5 w-fit rounded text-white disabled:bg-gray-400">Cancel
    </button>
  </div>

  <div>
    <button
      [routerLink]="['/stopgroup']"
      class="text-white p-1.5 m-1.5 bg-gray-700 appearance-none border rounded border-transparent">
      Add StopGroup
    </button>

    <button
      [routerLink]="['/stop']"
      class="text-white p-1.5 m-1.5 bg-gray-700 appearance-none border rounded border-transparent">
      Add Stop
    </button>
  </div>
</div>

<div class="flex">
  <div
    cdkDropList
    (cdkDropListDropped)="dropGroup($event)" class="w-2/3">
    @for (group of stopGroups(); track group) {
      <div class="bg-gray-200 p-5 m-10 rounded-xl" cdkDrag>
        <p class="font-bold">{{ group.name }}</p>
        <div class="flex justify-between">
          <p>{{ group.description }}</p>
          <button

            class="text-white p-1.5 my-1 bg-gray-700 appearance-none border rounded border-transparent"
            [routerLink]="['/stopgroup']"
            [queryParams]="{ id: group.id, name: group.name, description: group.description, isPublic: group.isPublic }">
            Details
          </button>
        </div>
        <div class="flex flex-col m-5"
             cdkDropList
             [cdkDropListConnectedTo]="getDropGroups()"
             [cdkDropListData]="group.stopIds"
             (cdkDropListDropped)="dropStop($event)"
             id="{{ 'group-' + group.id }}"
        >
          <p>Stops</p>
          @for (stopId of group.stopIds; track stopId) {
            <div class="mb-1 p-3 rounded-l flex justify-between items-center cursor-grab"
                 cdkDrag
            >
              <p class="ml-5">{{ getStopByStopId(stopId)?.name }}</p>
              <button
                class="text-white p-1 my-1 bg-gray-700 appearance-none border rounded border-transparent"
                [routerLink]="['/stop']"
                [queryParams]="{ id: getStopByStopId(stopId)?.id, name: getStopByStopId(stopId)?.name, description: getStopByStopId(stopId)?.description, roomNr: getStopByStopId(stopId)?.roomNr, stopGroupID: group.id, divisionID: 1 }">
                Details
              </button>
            </div>
          }
        </div>
      </div>
    }
  </div>
  <div class="w-1/3">
    <div
      cdkDropList
      [cdkDropListConnectedTo]="getDropGroups()"
      class="bg-gray-200 p-5 m-10 rounded-xl"
      id='all-stops'>
      <p>Unassigned Stops</p>
      @for (stop of stops(); track stop.id) {
        <div class="mb-1 p-3 rounded-l cursor-grab flex items-center justify-between"
             cdkDrag
        >
          <p>{{ stop.name }}</p>
          <button
            class="text-white p-1.5 my-1 bg-gray-700 appearance-none border rounded border-transparent"
            [routerLink]="['/stop']"
            [queryParams]="{ id: stop.id, name: stop.name, description: stop.description, roomNr: stop.roomNr, stopGroupID: 1 }">
            Details
          </button>
        </div>
      }
    </div>
  </div>
  <div class="fixed bottom-4 right-4 w-96">
    @for (info of infos(); track info) {
      <app-info-popup (deleted)="deleteInfo($event)" [info]="info"></app-info-popup>
    }
  </div>
</div>
