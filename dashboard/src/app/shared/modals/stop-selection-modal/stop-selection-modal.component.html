<div
  class="stops-popup z-[9999] mt-2 max-h-[400px] w-64 overflow-y-auto rounded-lg border border-base-300 bg-base-100 shadow-xl"
>
  <div class="p-4">
    <div class="mb-3">
      <input
        type="text"
        placeholder="Search stops..."
        class="input input-sm input-bordered w-full"
        [(ngModel)]="searchTerm"
      />
    </div>

    <div class="mb-4 max-h-[200px] overflow-y-auto">
      @for (stop of filteredStops(); track stop.id) {
        <div class="form-control">
          <label class="label cursor-pointer rounded-lg px-2 hover:bg-base-200">
            <span class="label-text mr-2">{{ stop.name }}</span>
            <input
              type="checkbox"
              class="checkbox"
              [checked]="isStopSelected(student!, stop.id)"
              (change)="onToggle(stop, $event)"
            />
          </label>
        </div>
      }
      @if (filteredStops().length === 0) {
        <div class="py-4 text-center text-gray-500">No stops found</div>
      }
    </div>
    <div class="flex justify-end gap-2 border-t border-base-300 pt-2">
      <button class="btn btn-ghost btn-sm" (click)="onCancel()">Cancel</button>
      <button
        class="btn btn-primary btn-sm"
        (click)="onApply()"
        [disabled]="!student.selectedStops?.size"
      >
        Apply
      </button>
    </div>
  </div>
</div>
