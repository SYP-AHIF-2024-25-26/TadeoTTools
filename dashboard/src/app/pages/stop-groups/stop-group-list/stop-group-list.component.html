<app-stop-group-header
  [hasChanged]="hasChanged()"
  [onlyPublicGroups]="onlyPublicGroups()"
  (addGroup)="showGroupPopUp(-1)"
  (toggleCollapse)="toggleShowStops()"
  (togglePublicGroups)="onlyPublicGroups.set(!onlyPublicGroups())"
  (save)="saveChanges()"
  (cancel)="initialiseData()"
/>

<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col gap-6 md:flex-row">
    <!-- Stop Groups Column -->
    <div class="w-full md:max-w-4xl md:flex-1">
      <app-stop-group-list
        [stopGroups]="stopGroups()"
        [onlyPublicGroups]="onlyPublicGroups()"
        [stops]="stops()"
        [connectedDropLists]="dropGroups()"
        (dropGroup)="dropGroup($event)"
        (dropStop)="dropStop($event)"
        (showGroupPopup)="showGroupPopUp($event)"
        (removeStop)="selectStopToRemove($event.stopId, $event.group)"
        (openAddStopPopup)="openAddStopPopup($event)"
      />
    </div>

    <!-- Sidebar (Desktop only) -->
    <div class="hidden w-80 flex-shrink-0 md:block">
      <app-stop-sidebar
        [filteredStops]="filteredStops()"
        [divisions]="divisions()"
        [showAssignedStops]="showAssignedStops()"
        [connectedDropLists]="dropGroups()"
        (filterChange)="divisionFilter.set($event)"
        (toggleShowAssignedStops)="showAssignedStops.set(!showAssignedStops())"
      />
    </div>
  </div>
</div>

<!-- Info Notifications -->
<div class="fixed bottom-4 right-4 z-50 space-y-2">
  @for (info of infos(); track info) {
    <app-info-popup
      (deleted)="deleteInfo($event)"
      [info]="info"
    ></app-info-popup>
  }
</div>

<!-- Modal Dialogs -->
@if (showRemoveStopPopup()) {
  <app-delete-popup
    [title]="'Remove Stop'"
    [message]="'Are you sure you want to remove this stop from the stop group?'"
    (cancel)="showRemoveStopPopup.set(false)"
    (removeConfirmed)="removeStop()"
  />
}

@if (showGroupDetailPopUp()) {
  <app-stopgroup-details
    [id]="groupIdDetail"
    (cancel)="handleGroupPopupClose()"
  />
}

@if (showAddStopDropDownPopup()) {
  <app-add-stop-dialog
    [stops]="stopsNotInStopGroup()"
    (close)="showAddStopDropDownPopup.set(false)"
    (addStop)="addStopBtnClick($event)"
  />
}
